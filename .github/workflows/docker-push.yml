name: ðŸš€ Build and Push

on:
  push:
    branches: [main]

jobs:
  build-push:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout
      uses: actions/checkout@v3
    
    - name: ðŸ—ï¸ Build Docker Image
      id: build
      run: |
        docker build -t number-guessing-game .
        echo "âœ… Build completed"
    
    # ÙÙ‚Ø· Ø§Ú¯Ø± secrets ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ù† push Ú©Ù†
    - name: ðŸ” Login to Docker Hub
      if: secrets.DOCKER_USERNAME != '' && secrets.DOCKER_PASSWORD != ''
      run: |
        echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin
    
    - name: ðŸ·ï¸ Tag Image
      if: secrets.DOCKER_USERNAME != '' && secrets.DOCKER_PASSWORD != ''
      run: |
        docker tag number-guessing-game ${{ secrets.DOCKER_USERNAME }}/number-guessing-game:latest
        docker tag number-guessing-game ${{ secrets.DOCKER_USERNAME }}/number-guessing-game:${{ github.sha }}
    
    - name: ðŸš€ Push to Docker Hub
      if: secrets.DOCKER_USERNAME != '' && secrets.DOCKER_PASSWORD != ''
      run: |
        docker push ${{ secrets.DOCKER_USERNAME }}/number-guessing-game:latest
        docker push ${{ secrets.DOCKER_USERNAME }}/number-guessing-game:${{ github.sha }}
        echo "âœ… Pushed to Docker Hub"
    
    - name: ðŸ“Š Final Report
      run: |
        echo "## ðŸŽ‰ Pipeline Complete!" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        if [ "${{ secrets.DOCKER_USERNAME }}" != "" ]; then
          echo "### ðŸ³ Docker Hub:" >> $GITHUB_STEP_SUMMARY
          echo "**Image:** \`${{ secrets.DOCKER_USERNAME }}/number-guessing-game:latest\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“¥ Pull Command:" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`bash" >> $GITHUB_STEP_SUMMARY
          echo "docker pull ${{ secrets.DOCKER_USERNAME }}/number-guessing-game" >> $GITHUB_STEP_SUMMARY
          echo "docker run -it ${{ secrets.DOCKER_USERNAME }}/number-guessing-game" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        else
          echo "### â„¹ï¸ Note:" >> $GITHUB_STEP_SUMMARY
          echo "Docker Hub push skipped (no credentials configured)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "To enable Docker Hub pushes, add DOCKER_USERNAME and DOCKER_PASSWORD secrets in repository settings." >> $GITHUB_STEP_SUMMARY
        fi
